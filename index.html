<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tıkla Kazan Uygulaması - Simülasyon</title>
    <style>
        /* Genel Ayarlar */
        body {
            font-family: sans-serif;
            margin: 0;
            background-color: #f0f2f5;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background-image: linear-gradient(to right, #9C27B0, #673AB7); /* Mor-mavi gradient */
        }

        /* Ortak Stil Bileşenleri */
        .btn-primary {
            background-color: #673AB7; /* Mor */
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 8px;
            font-size: 1.1em;
            cursor: pointer;
            width: 100%;
            transition: background-color 0.3s ease;
        }
        .btn-primary:hover {
            background-color: #5E35B1; /* Daha koyu mor */
        }
        .hidden {
            display: none !important;
        }
        .error-message {
            color: red;
            font-size: 0.9em;
            margin-top: 5px;
            text-align: left;
        }

        /* Giriş/Kayıt Sayfası Stilleri */
        #auth-page {
            text-align: center;
            padding: 20px;
            width: 100%; /* Sayfaya yayılmasını sağlar */
            display: flex; /* İçeriği ortalamak için */
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }

        #auth-page h1 {
            color: white; /* Başlık rengi beyaz */
            font-size: 2.5em;
            margin-bottom: 30px;
        }

        .auth-box {
            background-color: white;
            padding: 40px;
            border-radius: 15px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
            width: 350px;
            max-width: 90%;
        }

        .auth-box h2 {
            color: #4A148C; /* Koyu mor */
            margin-bottom: 30px;
            font-size: 1.8em;
        }

        .input-group {
            margin-bottom: 20px;
            text-align: left;
        }

        .input-group label {
            display: block;
            margin-bottom: 8px;
            color: #555;
            font-weight: bold;
        }

        .input-group input {
            width: calc(100% - 20px); /* Padding için ayar */
            padding: 12px 10px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 1em;
        }

        .input-group input::placeholder {
            color: #aaa;
        }

        .auth-box p {
            margin-top: 25px;
            color: #666;
        }

        .auth-box p a {
            color: #673AB7; /* Mor */
            text-decoration: none;
            font-weight: bold;
            cursor: pointer; /* Tıklanabilir olduğunu belirtmek için */
        }

        .auth-box p a:hover {
            text-decoration: underline;
        }

        /* Ana Ekran Stilleri */
        #dashboard-page, #admin-dashboard-page {
            background-color: #f0f2f5;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
            width: 600px;
            max-width: 95%;
            margin: 30px auto; /* Üstten boşluk ve ortalama */
            background-image: linear-gradient(to bottom, #ede7f6, #d1c4e9); /* Hafif mor gradient */
        }

        .dashboard-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
        }

        .dashboard-header h2 {
            color: #4A148C;
            font-size: 2em;
            margin: 0;
        }

        .btn-logout {
            background-color: #E91E63; /* Pembe */
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 20px;
            font-size: 0.9em;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }

        .btn-logout:hover {
            background-color: #C2185B;
        }

        .balance-section {
            background-color: #673AB7; /* Mor */
            color: white;
            padding: 25px;
            border-radius: 12px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            font-size: 1.1em;
        }

        .balance-amount {
            font-size: 2.2em;
            font-weight: bold;
        }

        .btn-withdraw {
            background-color: #4CAF50; /* Yeşil */
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 20px;
            font-size: 1em;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }

        .btn-withdraw:hover {
            background-color: #43A047;
        }

        .section-title {
            color: #4A148C;
            font-size: 1.6em;
            margin-top: 30px;
            margin-bottom: 15px;
        }

        .click-info {
            color: #555;
            margin-bottom: 25px;
            font-size: 1.1em;
        }

        .card-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
        }

        .card {
            background-color: white;
            padding: 25px;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.08);
            text-align: center;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            align-items: center;
            min-height: 150px; /* Kartların yaklaşık aynı yükseklikte olmasını sağlar */
        }

        .card h4 {
            margin-top: 0;
            margin-bottom: 10px;
            font-size: 1.4em;
            color: white; /* Kart başlıkları beyaz */
        }

        .card p {
            color: white; /* Kart metni beyaz */
            font-size: 0.95em;
            margin-bottom: 20px;
        }

        .btn-card {
            background-color: rgba(255, 255, 255, 0.2); /* Yarı şeffaf beyaz */
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.4);
            padding: 10px 20px;
            border-radius: 25px;
            font-size: 1em;
            cursor: pointer;
            transition: background-color 0.3s ease, border-color 0.3s ease;
        }

        .btn-card:hover {
            background-color: rgba(255, 255, 255, 0.3);
            border-color: white;
        }

        /* Kart renkleri */
        .card-purple {
            background-color: #9C27B0; /* Mor */
        }
        .card-light-purple {
            background-color: #BA68C8; /* Açık mor */
        }
        .card-pink {
            background-color: #E91E63; /* Pembe */
        }
        .card-orange {
            background-color: #FFC107; /* Turuncu */
        }
        .card-blue {
            background-color: #2196F3; /* Mavi - Reklam için */
        }
        .card-green {
            background-color: #4CAF50; /* Yeşil - Çark için */
        }

        /* Çark Stilleri */
        #wheel-container {
            position: relative;
            width: 250px;
            height: 250px;
            margin: 20px auto;
            border-radius: 50%;
            overflow: hidden;
            border: 5px solid #673AB7;
            box-shadow: 0 0 15px rgba(0, 0, 0, 0.2);
        }

        #wheel {
            width: 100%;
            height: 100%;
            border-radius: 50%;
            position: relative;
            transition: transform 4s cubic-bezier(0.25, 0.1, 0.25, 1); /* Yavaş başla, hızlı bitir */
        }

        .wheel-segment {
            position: absolute;
            width: 50%;
            height: 50%;
            transform-origin: 100% 100%;
            left: 50%;
            top: 50%;
            overflow: hidden;
            display: flex;
            justify-content: center;
            align-items: center;
            font-weight: bold;
            color: white;
            font-size: 1.1em;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.5);
        }

        /* Çark segmentleri renkleri ve dönüşleri (örnek) */
        .segment-0 { background-color: #FFEB3B; transform: rotate(0deg) skewY(45deg); } /* Sarı */
        .segment-1 { background-color: #4CAF50; transform: rotate(45deg) skewY(45deg); } /* Yeşil */
        .segment-2 { background-color: #2196F3; transform: rotate(90deg) skewY(45deg); } /* Mavi */
        .segment-3 { background-color: #E91E63; transform: rotate(135deg) skewY(45deg); } /* Pembe */
        .segment-4 { background-color: #9C27B0; transform: rotate(180deg) skewY(45deg); } /* Mor */
        .segment-5 { background-color: #FF5722; transform: rotate(225deg) skewY(45deg); } /* Turuncu */
        .segment-6 { background-color: #00BCD4; transform: rotate(270deg) skewY(45deg); } /* Turkuaz */
        .segment-7 { background-color: #8BC34A; transform: rotate(315deg) skewY(45deg); } /* Açık Yeşil */

        /* Metni düzeltmek için ters skew */
        .wheel-segment span {
            transform: skewY(-45deg) rotate(22.5deg); /* Tekrar düzelt ve ortaya döndür */
            position: absolute;
        }

        #wheel-pointer {
            position: absolute;
            top: -15px;
            left: 50%;
            transform: translateX(-50%);
            width: 0;
            height: 0;
            border-left: 15px solid transparent;
            border-right: 15px solid transparent;
            border-bottom: 25px solid #FFC107; /* Turuncu ok */
            z-index: 10;
        }
        #spin-button {
            margin-top: 20px;
            background-color: #FFC107; /* Turuncu */
            color: #333;
            font-weight: bold;
            border: none;
            padding: 15px 30px;
            border-radius: 8px;
            font-size: 1.2em;
            cursor: pointer;
            width: 100%;
            transition: background-color 0.3s ease;
        }
        #spin-button:hover:not(:disabled) {
            background-color: #FFB300; /* Daha koyu turuncu */
        }
        #spin-button:disabled {
            background-color: #cccccc;
            cursor: not-allowed;
            color: #666;
        }
        #wheel-message {
            margin-top: 15px;
            font-size: 1em;
            color: #555;
            font-weight: bold;
        }


        /* İşlem Geçmişi Stilleri */
        #transaction-history {
            margin-top: 20px;
            background-color: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
        }
        #transaction-history h3 {
            color: #4A148C;
            margin-top: 0;
            margin-bottom: 15px;
        }
        #transaction-history ul {
            list-style: none;
            padding: 0;
            margin: 0;
        }
        #transaction-history li {
            padding: 10px 0;
            border-bottom: 1px solid #eee;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        #transaction-history li:last-child {
            border-bottom: none;
        }
        #transaction-history .transaction-type {
            font-weight: bold;
            color: #333;
        }
        #transaction-history .transaction-amount {
            font-weight: bold;
        }
        #transaction-history .transaction-amount.positive {
            color: #4CAF50; /* Yeşil */
        }
        #transaction-history .transaction-amount.negative {
            color: #E91E63; /* Pembe */
        }
        #transaction-history .transaction-date {
            font-size: 0.85em;
            color: #777;
        }

        /* Reklam İzleme Pop-up Simülasyonu */
        #ad-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        #ad-content {
            background-color: white;
            padding: 30px;
            border-radius: 10px;
            text-align: center;
            width: 90%;
            max-width: 500px;
            box-shadow: 0 5px 25px rgba(0, 0, 0, 0.3);
            position: relative;
        }

        #ad-content h3 {
            color: #4A148C;
            margin-top: 0;
            margin-bottom: 20px;
            font-size: 1.8em;
        }

        #ad-video-placeholder {
            width: 100%;
            height: 250px;
            background-color: #e0e0e0;
            border: 1px solid #ccc;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 1.2em;
            color: #666;
            margin-bottom: 20px;
            border-radius: 5px;
        }

        #ad-countdown {
            font-size: 1.5em;
            font-weight: bold;
            color: #673AB7;
            margin-bottom: 20px;
        }

        #close-ad-button {
            background-color: #E91E63;
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 25px;
            font-size: 1em;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }
        #close-ad-button:hover:not(:disabled) {
            background-color: #C2185B;
        }
        #close-ad-button:disabled {
            background-color: #cccccc;
            cursor: not-allowed;
        }

        /* Site Mesaj Kutusu */
        #site-message-box {
            background-color: #e3f2fd; /* Açık mavi */
            border: 1px solid #90caf9; /* Mavi kenarlık */
            border-radius: 8px;
            padding: 15px 20px;
            margin-bottom: 25px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 0.95em;
            color: #1a237e; /* Koyu mavi metin */
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }

        #site-message-box p {
            margin: 0;
            flex-grow: 1; /* Metnin alanı doldurmasını sağlar */
        }

        #site-message-box button {
            background: none;
            border: none;
            color: #1a237e;
            font-size: 1.5em;
            cursor: pointer;
            margin-left: 15px;
            transition: color 0.2s ease;
        }
        #site-message-box button:hover {
            color: #0d47a1;
        }

        /* Admin Paneli Stilleri */
        #admin-dashboard-page {
            background-color: #ffe0b2; /* Açık turuncu */
            background-image: linear-gradient(to bottom, #ffe0b2, #ffcc80); /* Hafif turuncu gradient */
        }
        #admin-dashboard-page h2 {
            color: #E65100; /* Koyu turuncu */
        }
        #admin-dashboard-page .section-title {
            color: #E65100;
        }

        #user-list ul {
            list-style: none;
            padding: 0;
        }
        #user-list li {
            background-color: white;
            margin-bottom: 10px;
            padding: 15px;
            border-radius: 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 1px 3px rgba(0,0,0,0.05);
        }
        #user-list li strong {
            color: #333;
        }
        #user-list li span {
            color: #666;
            font-size: 0.9em;
            margin-left: 10px;
        }
        .admin-action-group {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }
        .admin-action-group input[type="number"] {
            width: 80px;
            padding: 5px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        .admin-action-group button {
            background-color: #FF9800; /* Turuncu */
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.2s ease;
        }
        .admin-action-group button:hover {
            background-color: #FB8C00;
        }


        /* Responsive tasarım için temel ayarlar */
        @media (max-width: 768px) {
            .auth-box {
                width: 90%;
                padding: 30px;
            }
            #dashboard-page, #admin-dashboard-page {
                padding: 20px;
                width: 95%;
            }
            .card-grid {
                grid-template-columns: 1fr; /* Küçük ekranlarda tek sütun */
            }
            #wheel-container {
                width: 200px;
                height: 200px;
            }
            .wheel-segment {
                font-size: 0.9em;
            }
            #ad-video-placeholder {
                height: 150px;
            }
        }
    </style>
</head>
<body>

    <div id="auth-page">
        <h1>Tıkla Kazan</h1>
        <div class="auth-box">
            <h2 id="auth-title">Giriş Yap</h2>
            <form id="auth-form">
                <div class="input-group">
                    <label for="auth-username">Kullanıcı Adı</label>
                    <input type="text" id="auth-username" name="username" placeholder="Kullanıcı adınız" required>
                    <div id="username-error" class="error-message hidden"></div>
                </div>
                <div class="input-group">
                    <label for="auth-password">Şifre</label>
                    <input type="password" id="auth-password" name="password" placeholder="Şifreniz" required>
                    <div id="password-error" class="error-message hidden"></div>
                </div>
                <div class="input-group hidden" id="confirm-password-group">
                    <label for="auth-confirm-password">Şifre Tekrar</label>
                    <input type="password" id="auth-confirm-password" name="confirm_password" placeholder="Şifrenizi tekrar girin" required>
                    <div id="confirm-password-error" class="error-message hidden"></div>
                </div>
                <button type="submit" class="btn-primary" id="auth-button">Giriş Yap</button>
            </form>
            <p id="auth-toggle-text">Hesabınız yok mu? <a href="#" id="toggle-auth-mode">Kayıt Ol</a></p>
            <div id="general-error" class="error-message hidden"></div>
        </div>
    </div>

    <div id="dashboard-page" class="hidden">
        <header class="dashboard-header">
            <h2 id="welcome-message">Hoş Geldin, Kullanıcı!</h2>
            <button class="btn-logout" id="logout-button">Çıkış</button>
        </header>

        <div id="site-message-box" class="hidden">
            <p id="site-message-text"></p>
            <button id="dismiss-site-message">&times;</button>
        </div>

        <div class="balance-section">
            <span>Bakiyeniz</span>
            <span class="balance-amount" id="current-balance">0.00 TL</span>
            <button class="btn-withdraw" id="withdraw-button">Para Çek</button>
        </div>

        <h3 class="section-title">Kazanç Fırsatları</h3>

        <div class="card-grid">
            <div class="card card-purple">
                <h4>Reklam Tıklama</h4>
                <p>Her tıklama için <span id="click-amount-display">0.01 TL</span> kazanın!</p>
                <button class="btn-card click-ad-button" data-reward="0.01">+0.01 TL</button>
            </div>
            <div class="card card-blue">
                <h4>Video Reklam İzle</h4>
                <p>Video izleyerek daha fazla kazanın!</p>
                <button class="btn-card" id="watch-ad-button">Reklam İzle (0.10 TL)</button>
            </div>
            <div class="card card-green">
                <h4>Şans Çarkı</h4>
                <p>Günde bir kez çevir, büyük ödüller kazan!</p>
                <button class="btn-card" id="spin-wheel-button">Çarkı Çevir</button>
            </div>
            <div class="card card-orange">
                <h4>Özel Görevler</h4>
                <p>Yakında daha fazla görev eklenecek!</p>
                <button class="btn-card" disabled>Çok Yakında</button>
            </div>
        </div>

        <h3 class="section-title" id="wheel-section-title">Şans Çarkı</h3>
        <div class="card" style="background-color: #673AB7;">
            <div id="wheel-container">
                <div id="wheel">
                    </div>
                <div id="wheel-pointer"></div>
            </div>
            <button id="spin-button">Çarkı Çevir!</button>
            <p id="wheel-message">Bugün çarkı çevirmediniz.</p>
        </div>

        <h3 class="section-title">İşlem Geçmişi (Son 5)</h3>
        <div id="transaction-history">
            <ul id="history-list">
                </ul>
            <p id="no-history-message" style="text-align: center; color: #777;">Henüz işlem geçmişiniz yok.</p>
        </div>
    </div>

    <div id="admin-dashboard-page" class="hidden">
        <header class="dashboard-header">
            <h2>Admin Paneli</h2>
            <button class="btn-logout" id="admin-logout-button">Çıkış</button>
        </header>

        <h3 class="section-title">Kullanıcı Yönetimi</h3>
        <div id="user-list">
            <ul>
                </ul>
            <p id="no-users-message" style="text-align: center; color: #777;">Henüz kayıtlı kullanıcı yok.</p>
        </div>

        <h3 class="section-title">Site Mesajı Ayarı</h3>
        <div class="card" style="background-color: #e3f2fd; color: #1a237e;">
            <h4>Yeni Site Mesajı Belirle</h4>
            <textarea id="admin-site-message-input" rows="3" style="width: calc(100% - 20px); padding: 10px; margin-bottom: 10px; border-radius: 5px; border: 1px solid #ccc;" placeholder="Siteye yeni bir duyuru girin..."></textarea>
            <button class="btn-primary" id="admin-set-site-message" style="background-color: #007bff; width: auto;">Mesajı Kaydet</button>
            <button class="btn-primary" id="admin-clear-site-message" style="background-color: #dc3545; width: auto; margin-left: 10px;">Mesajı Temizle</button>
        </div>
    </div>


    <div id="ad-modal" class="hidden">
        <div id="ad-content">
            <h3>Reklam İzleniyor...</h3>
            <div id="ad-video-placeholder">
                <p>Burada video reklam oynatılıyor...</p>
            </div>
            <p id="ad-countdown">Kalan süre: 5 saniye</p>
            <button id="close-ad-button" disabled>Reklamı Kapat</button>
        </div>
    </div>

    <script>
        // DOM Elementleri
        const authPage = document.getElementById('auth-page');
        const dashboardPage = document.getElementById('dashboard-page');
        const adminDashboardPage = document.getElementById('admin-dashboard-page'); // Admin paneli
        const authTitle = document.getElementById('auth-title');
        const authForm = document.getElementById('auth-form');
        const authUsernameInput = document.getElementById('auth-username');
        const authPasswordInput = document.getElementById('auth-password');
        const confirmPasswordGroup = document.getElementById('confirm-password-group');
        const authConfirmPasswordInput = document.getElementById('auth-confirm-password');
        const authButton = document.getElementById('auth-button');
        const authToggleText = document.getElementById('auth-toggle-text');
        const toggleAuthModeLink = document.getElementById('toggle-auth-mode');
        const welcomeMessage = document.getElementById('welcome-message');
        const currentBalanceSpan = document.getElementById('current-balance');
        const withdrawButton = document.getElementById('withdraw-button');
        const logoutButton = document.getElementById('logout-button');
        const clickAdButtons = document.querySelectorAll('.click-ad-button');
        const historyList = document.getElementById('history-list');
        const noHistoryMessage = document.getElementById('no-history-message');

        const usernameError = document.getElementById('username-error');
        const passwordError = document.getElementById('password-error');
        const confirmPasswordError = document.getElementById('confirm-password-error');
        const generalError = document.getElementById('general-error');

        // Yeni Elementler (Reklam, Çark, Mesaj, Admin)
        const watchAdButton = document.getElementById('watch-ad-button');
        const adModal = document.getElementById('ad-modal');
        const adCountdown = document.getElementById('ad-countdown');
        const closeAdButton = document.getElementById('close-ad-button');
        const clickAmountDisplay = document.getElementById('click-amount-display');

        const spinWheelButton = document.getElementById('spin-wheel-button');
        const wheel = document.getElementById('wheel');
        const spinButton = document.getElementById('spin-button');
        const wheelMessage = document.getElementById('wheel-message');

        const siteMessageBox = document.getElementById('site-message-box');
        const siteMessageText = document.getElementById('site-message-text');
        const dismissSiteMessageButton = document.getElementById('dismiss-site-message');

        const adminLogoutButton = document.getElementById('admin-logout-button');
        const userListDiv = document.getElementById('user-list');
        const userListUl = userListDiv.querySelector('ul');
        const noUsersMessage = document.getElementById('no-users-message');
        const adminSiteMessageInput = document.getElementById('admin-site-message-input');
        const adminSetSiteMessageButton = document.getElementById('admin-set-site-message');
        const adminClearSiteMessageButton = document.getElementById('admin-clear-site-message');

        // Uygulama Durumu
        let isRegisterMode = false;
        let currentUser = null; // Giriş yapan kullanıcının verileri

        // Sabitler
        const CLICK_REWARD = 0.01; // Her tıklama için kazanılan miktar
        const AD_REWARD = 0.10; // Her reklam izleme için kazanılan miktar
        const AD_DURATION_SECONDS = 5; // Reklam izleme süresi (simülasyon)
        const MAX_HISTORY_ITEMS = 5; // Gösterilecek maksimum işlem geçmişi sayısı

        const WHEEL_PRIZES = [0.05, 0.10, 0.25, 0.50, 1.00, 0.00, 0.00, 0.00]; // Çark ödülleri
        
        // Admin kullanıcı bilgileri (GERÇEK UYGULAMADA KESİNLİKLE BÖYLE OLMAZ!)
        const ADMIN_USERNAME = 'admin';
        const ADMIN_PASSWORD = 'adminpassword';

        // Çark Segmentleri Oluşturma
        function createWheelSegments() {
            const numSegments = WHEEL_PRIZES.length;
            const segmentAngle = 360 / numSegments;
            wheel.innerHTML = ''; // Öncekileri temizle

            WHEEL_PRIZES.forEach((prize, index) => {
                const segment = document.createElement('div');
                segment.classList.add('wheel-segment');
                segment.classList.add(`segment-${index % 8}`); // 8 farklı renk sınıfı kullan
                segment.style.transform = `rotate(${segmentAngle * index}deg) skewY(${90 - segmentAngle}deg)`;
                
                const span = document.createElement('span');
                span.textContent = prize.toFixed(2) + ' TL'; // Ödül miktarını göster
                // Metni düzeltmek için ters skew ve rotate
                span.style.transform = `skewY(${-(90 - segmentAngle)}deg) rotate(${segmentAngle / 2}deg)`;
                
                segment.appendChild(span);
                wheel.appendChild(segment);
            });
        }


        // Yardımcı Fonksiyonlar
        function showPage(pageId) {
            authPage.classList.add('hidden');
            dashboardPage.classList.add('hidden');
            adminDashboardPage.classList.add('hidden');
            
            // CSS'teki display değerine göre show/hide yap
            if (pageId === 'auth-page') {
                document.getElementById(pageId).style.display = 'flex';
            } else {
                document.getElementById(pageId).style.display = 'block';
            }
            document.getElementById(pageId).classList.remove('hidden');
        }

        function clearErrors() {
            usernameError.textContent = '';
            usernameError.classList.add('hidden');
            passwordError.textContent = '';
            passwordError.classList.add('hidden');
            confirmPasswordError.textContent = '';
            confirmPasswordError.classList.add('hidden');
            generalError.textContent = '';
            generalError.classList.add('hidden');
        }

        function displayError(element, message) {
            element.textContent = message;
            element.classList.remove('hidden');
        }

        function updateBalanceDisplay() {
            if (currentUser) {
                currentBalanceSpan.textContent = currentUser.balance.toFixed(2) + ' TL';
            }
        }

        function updateTransactionHistory() {
            historyList.innerHTML = ''; // Önceki geçmişi temizle
            if (currentUser && currentUser.history && currentUser.history.length > 0) {
                noHistoryMessage.classList.add('hidden');
                // Son MAX_HISTORY_ITEMS işlemi göstermek için dizinin sonundan başa doğru elemanları al
                const lastTransactions = currentUser.history.slice(Math.max(currentUser.history.length - MAX_HISTORY_ITEMS, 0)).reverse();

                lastTransactions.forEach(transaction => {
                    const listItem = document.createElement('li');
                    const amountClass = transaction.amount > 0 ? 'positive' : 'negative';
                    listItem.innerHTML = `
                        <span class="transaction-type">${transaction.type}</span>
                        <span class="transaction-amount ${amountClass}">${transaction.amount.toFixed(2)} TL</span>
                        <span class="transaction-date">${new Date(transaction.date).toLocaleString()}</span>
                    `;
                    historyList.appendChild(listItem);
                });
            } else {
                noHistoryMessage.classList.remove('hidden');
            }
        }

        function saveUsersToLocalStorage() {
            localStorage.setItem('users', JSON.stringify(getUsersFromLocalStorage()));
        }

        function getUsersFromLocalStorage() {
            try {
                const users = JSON.parse(localStorage.getItem('users')) || {};
                return users;
            } catch (e) {
                console.error("localStorage'dan kullanıcılar okunurken hata:", e);
                return {};
            }
        }

        function saveCurrentUserToLocalStorage() {
            if (currentUser) {
                const users = getUsersFromLocalStorage();
                users[currentUser.username] = currentUser;
                localStorage.setItem('users', JSON.stringify(users));
            }
        }

        function addTransaction(type, amount) {
            if (currentUser) {
                if (!currentUser.history) {
                    currentUser.history = [];
                }
                currentUser.history.push({
                    type: type,
                    amount: amount,
                    date: new Date().toISOString()
                });
                // Sadece son MAX_HISTORY_ITEMS işlemi tut
                currentUser.history = currentUser.history.slice(-MAX_HISTORY_ITEMS); 
                saveCurrentUserToLocalStorage();
                updateTransactionHistory();
            }
        }

        // Çark çevirme durumu ve tarihi kontrolü
        function checkWheelSpinAvailability() {
            if (!currentUser) return;

            const today = new Date().toDateString();
            if (currentUser.lastSpinDate === today) {
                spinButton.disabled = true;
                wheelMessage.textContent = 'Bugün çarkı çevirdiniz. Yarın tekrar deneyin!';
            } else {
                spinButton.disabled = false;
                wheelMessage.textContent = 'Günde bir kez çarkı çevirerek ödül kazanabilirsiniz!';
            }
        }

        // Site mesajını göster/gizle
        function showSiteMessage() {
            const message = localStorage.getItem('siteMessage');
            const dismissed = localStorage.getItem('siteMessageDismissed');

            if (message && dismissed !== 'true') {
                siteMessageText.textContent = message;
                siteMessageBox.classList.remove('hidden');
            } else {
                siteMessageBox.classList.add('hidden');
            }
        }

        function dismissSiteMessage() {
            localStorage.setItem('siteMessageDismissed', 'true');
            siteMessageBox.classList.add('hidden');
        }


        // Admin Paneli Fonksiyonları
        function renderUserList() {
            userListUl.innerHTML = '';
            const users = getUsersFromLocalStorage();
            const userArray = Object.values(users).filter(user => user.username !== ADMIN_USERNAME); // Admin'i listeden çıkar

            if (userArray.length === 0) {
                noUsersMessage.classList.remove('hidden');
                return;
            }
            noUsersMessage.classList.add('hidden');

            userArray.forEach(user => {
                const listItem = document.createElement('li');
                listItem.innerHTML = `
                    <div>
                        <strong>${user.username}</strong>
                        <span>Bakiye: ${user.balance.toFixed(2)} TL</span>
                    </div>
                    <div class="admin-action-group">
                        <input type="number" step="0.01" value="${user.balance.toFixed(2)}" id="balance-input-${user.username}">
                        <button data-username="${user.username}" class="set-balance-button">Bakiye Ayarla</button>
                    </div>
                `;
                userListUl.appendChild(listItem);
            });

            // Bakiye ayarlama butonlarına event listener ekle
            document.querySelectorAll('.set-balance-button').forEach(button => {
                button.addEventListener('click', function() {
                    const usernameToUpdate = this.dataset.username;
                    const newBalanceInput = document.getElementById(`balance-input-${usernameToUpdate}`);
                    let newBalance = parseFloat(newBalanceInput.value);

                    if (isNaN(newBalance) || newBalance < 0) {
                        alert('Geçersiz bakiye miktarı.');
                        return;
                    }

                    const users = getUsersFromLocalStorage();
                    if (users[usernameToUpdate]) {
                        users[usernameToUpdate].balance = newBalance;
                        localStorage.setItem('users', JSON.stringify(users));
                        alert(`${usernameToUpdate} kullanıcısının bakiyesi ${newBalance.toFixed(2)} TL olarak ayarlandı.`);
                        renderUserList(); // Listeyi güncelle
                        // Eğer güncellenen kullanıcı şu an giriş yapmışsa, onun bakiyesini de güncelle
                        if (currentUser && currentUser.username === usernameToUpdate) {
                            currentUser.balance = newBalance;
                            updateBalanceDisplay();
                        }
                    }
                });
            });
        }

        function updateAdminSiteMessageSection() {
            const currentMessage = localStorage.getItem('siteMessage');
            adminSiteMessageInput.value = currentMessage || '';
        }

        // Event Dinleyiciler

        // Giriş/Kayıt Formu Gönderimi
        authForm.addEventListener('submit', function(event) {
            event.preventDefault();
            clearErrors();

            const username = authUsernameInput.value.trim();
            const password = authPasswordInput.value.trim();
            const confirmPassword = authConfirmPasswordInput.value.trim();
            const users = getUsersFromLocalStorage();

            // Admin girişi kontrolü
            if (username === ADMIN_USERNAME && password === ADMIN_PASSWORD && !isRegisterMode) {
                showPage('admin-dashboard-page');
                renderUserList(); // Admin paneli açıldığında kullanıcı listesini yükle
                updateAdminSiteMessageSection(); // Admin paneli açıldığında site mesajını yükle
                return;
            }

            // Form validasyonları (admin değilse veya kayıt modundaysa)
            if (!username) {
                displayError(usernameError, 'Kullanıcı adı boş olamaz.');
                return;
            }
            if (username.length < 3) {
                displayError(usernameError, 'Kullanıcı adı en az 3 karakter olmalı.');
                return;
            }
            if (!password) {
                displayError(passwordError, 'Şifre boş olamaz.');
                return;
            }
            if (password.length < 6) {
                displayError(passwordError, 'Şifre en az 6 karakter olmalı.');
                return;
            }

            if (isRegisterMode) {
                // Sadece kayıt modundaysa şifre tekrarını kontrol et
                if (!confirmPassword) {
                    displayError(confirmPasswordError, 'Şifre tekrarı boş olamaz.');
                    return;
                }
                if (password !== confirmPassword) {
                    displayError(confirmPasswordError, 'Şifreler eşleşmiyor.');
                    return;
                }
                if (users[username]) {
                    displayError(generalError, 'Bu kullanıcı adı zaten alınmış.');
                    return;
                }

                // Yeni kullanıcı oluştur
                currentUser = {
                    username: username,
                    password: password, // Gerçek uygulamada şifre hashlenir
                    balance: 0.00,
                    history: [],
                    lastSpinDate: null // Yeni kullanıcı için çark çevirme tarihi
                };
                users[username] = currentUser;
                localStorage.setItem('users', JSON.stringify(users)); // Tüm kullanıcıları kaydet
                alert('Kayıt başarılı! Şimdi giriş yapabilirsiniz.');
                toggleAuthMode(false); // Kayıt modundan giriş moduna geç
                authUsernameInput.value = '';
                authPasswordInput.value = '';
                authConfirmPasswordInput.value = '';

            } else { // Giriş Modu (normal kullanıcı)
                if (!users[username] || users[username].password !== password) {
                    displayError(generalError, 'Kullanıcı adı veya şifre yanlış.');
                    return;
                }
                currentUser = users[username];
                welcomeMessage.textContent = `Hoş Geldin, ${currentUser.username}!`;
                updateBalanceDisplay();
                updateTransactionHistory();
                checkWheelSpinAvailability(); // Girişte çark durumunu kontrol et
                showSiteMessage(); // Girişte site mesajını göster
                localStorage.setItem('lastLoggedInUser', currentUser.username); // Son giriş yapanı kaydet
                showPage('dashboard-page');
            }
        });

        // Giriş/Kayıt Modu Değiştirme
        toggleAuthModeLink.addEventListener('click', function(event) {
            event.preventDefault();
            toggleAuthMode(!isRegisterMode);
        });

        function toggleAuthMode(toRegister) {
            isRegisterMode = toRegister;
            clearErrors();
            if (isRegisterMode) {
                authTitle.textContent = 'Kayıt Ol';
                authButton.textContent = 'Kayıt Ol';
                authToggleText.innerHTML = 'Hesabın var mı? <a href="#" id="toggle-auth-mode-inner">Giriş Yap</a>';
                confirmPasswordGroup.classList.remove('hidden'); // hidden sınıfını kaldır
                authConfirmPasswordInput.disabled = false; // input'u aktif et
                authConfirmPasswordInput.required = true; // gerekli yap

            } else {
                authTitle.textContent = 'Giriş Yap';
                authButton.textContent = 'Giriş Yap';
                authToggleText.innerHTML = 'Hesabınız yok mu? <a href="#" id="toggle-auth-mode-inner">Kayıt Ol</a>';
                confirmPasswordGroup.classList.add('hidden'); // hidden sınıfını ekle
                authConfirmPasswordInput.disabled = true; // input'u devre dışı bırak
                authConfirmPasswordInput.required = false; // gerekli özelliğini kaldır
            }
            // Yeni linki tekrar bağla
            document.getElementById('toggle-auth-mode-inner').addEventListener('click', function(e) {
                e.preventDefault();
                toggleAuthMode(!isRegisterMode);
            });
            authUsernameInput.value = '';
            authPasswordInput.value = '';
            authConfirmPasswordInput.value = '';
        }

        // Kullanıcı Çıkış Butonu
        logoutButton.addEventListener('click', function() {
            currentUser = null;
            localStorage.removeItem('lastLoggedInUser'); // Son giriş yapanı temizle
            showPage('auth-page');
            toggleAuthMode(false); // Varsayılan olarak giriş moduna dön
        });

        // Admin Çıkış Butonu
        adminLogoutButton.addEventListener('click', function() {
            currentUser = null; // Admin kullanıcı olarak da null yap
            localStorage.removeItem('lastLoggedInUser'); // Son giriş yapanı temizle (admin de olsa)
            showPage('auth-page');
            toggleAuthMode(false); // Varsayılan olarak giriş moduna dön
        });


        // Reklam Tıklama Butonları (mevcut)
        clickAdButtons.forEach(button => {
            button.addEventListener('click', function() {
                if (currentUser) {
                    const reward = parseFloat(this.dataset.reward);
                    currentUser.balance += reward;
                    addTransaction('Reklam Tıklaması', reward);
                    updateBalanceDisplay();
                    saveCurrentUserToLocalStorage(); // Güncel kullanıcı verilerini kaydet
                } else {
                    alert('Giriş yapmanız gerekiyor!');
                }
            });
        });

        // Reklam İzleme Butonu (YENİ)
        watchAdButton.addEventListener('click', function() {
            if (!currentUser) {
                alert('Giriş yapmanız gerekiyor!');
                return;
            }
            
            adModal.classList.remove('hidden');
            closeAdButton.disabled = true; // Kapatma butonunu devre dışı bırak
            let countdown = AD_DURATION_SECONDS;
            adCountdown.textContent = `Kalan süre: ${countdown} saniye`;

            const adInterval = setInterval(() => {
                countdown--;
                adCountdown.textContent = `Kalan süre: ${countdown} saniye`;

                if (countdown <= 0) {
                    clearInterval(adInterval);
                    closeAdButton.disabled = false; // Kapatma butonunu aktif et
                    adCountdown.textContent = 'Reklam bitti! Kapatabilirsiniz.';
                    
                    // Ödülü ver
                    currentUser.balance += AD_REWARD;
                    addTransaction('Video Reklam İzleme', AD_REWARD);
                    updateBalanceDisplay();
                    saveCurrentUserToLocalStorage();
                    // alert(`+${AD_REWARD.toFixed(2)} TL kazandınız!`); // Bu alert'i kaldırdık, arayüz daha iyi
                }
            }, 1000); // Her saniye güncelle

        });

        // Reklam Kapatma Butonu (YENİ)
        closeAdButton.addEventListener('click', function() {
            adModal.classList.add('hidden');
        });

        // Para Çekme Butonu
        withdrawButton.addEventListener('click', function() {
            if (currentUser) {
                const minWithdraw = 10.00; // Minimum çekim miktarı
                if (currentUser.balance >= minWithdraw) {
                    const withdrawAmountString = prompt(`Minimum ${minWithdraw.toFixed(2)} TL çekebilirsiniz. Ne kadar çekmek istersiniz? Mevcut Bakiye: ${currentUser.balance.toFixed(2)} TL`);
                    
                    if (withdrawAmountString === null) { // Kullanıcı iptal etti
                        return;
                    }

                    const withdrawAmount = parseFloat(withdrawAmountString);

                    if (isNaN(withdrawAmount) || withdrawAmount <= 0) {
                        alert('Geçersiz bir miktar girdiniz.');
                        return;
                    }
                    if (withdrawAmount > currentUser.balance) {
                        alert('Bakiyeniz yetersiz.');
                        return;
                    }
                    if (withdrawAmount < minWithdraw) {
                        alert(`Minimum ${minWithdraw.toFixed(2)} TL çekmelisiniz.`);
                        return;
                    }

                    currentUser.balance -= withdrawAmount;
                    addTransaction('Para Çekimi', -withdrawAmount); // Eksi olarak kaydet
                    updateBalanceDisplay();
                    saveCurrentUserToLocalStorage(); // Güncel kullanıcı verilerini kaydet
                    alert(`${withdrawAmount.toFixed(2)} TL başarıyla çekildi. Kalan bakiyeniz: ${currentUser.balance.toFixed(2)} TL`);
                } else {
                    alert(`Para çekmek için bakiyeniz en az ${minWithdraw.toFixed(2)} TL olmalıdır. Mevcut: ${currentUser.balance.toFixed(2)} TL`);
                }
            } else {
                alert('Giriş yapmanız gerekiyor!');
            }
        });

        // Çark Çevirme Butonu (YENİ)
        spinButton.addEventListener('click', function() {
            if (!currentUser) {
                alert('Giriş yapmanız gerekiyor!');
                return;
            }
            if (spinButton.disabled) {
                alert(wheelMessage.textContent);
                return;
            }

            spinButton.disabled = true;
            wheelMessage.textContent = 'Çark dönüyor...';

            // Rastgele bir ödül seç
            const randomIndex = Math.floor(Math.random() * WHEEL_PRIZES.length);
            const winningPrize = WHEEL_PRIZES[randomIndex];

            // Çarkı çevirmek için gerekli açı hesaplaması
            const numSegments = WHEEL_PRIZES.length;
            const segmentAngle = 360 / numSegments;
            const baseRotation = 360 * 5; // 5 tam tur
            // Hedef açıyı, kazanan segmentin tam ortasına gelmesini sağlayacak şekilde ayarla
            // Ok çarkın tepesinde duruyor, bu yüzden çarkı, kazanan segment oku gösterecek şekilde döndürmeliyiz.
            // Segmentlerin döndüğü açılar (0, 45, 90, ...)
            // Okun tam ortasına gelmesi için 22.5 (segmentAngle / 2) daha eklememiz gerekir.
            // (360 - (randomIndex * segmentAngle + segmentAngle / 2)) bu kısım, ok'un tepesine denk gelmesi için gereken başlangıç açısı
            const targetRotation = baseRotation + (360 - (randomIndex * segmentAngle + segmentAngle / 2));

            // Biraz rastgelelik ekleyelim ki her seferinde aynı yerde durmasın
            const randomOffset = Math.random() * (segmentAngle * 0.8) - (segmentAngle * 0.4); // Segment içinde biraz oynama
            const finalTargetRotation = targetRotation + randomOffset;

            wheel.style.transition = 'transform 4s cubic-bezier(0.25, 0.1, 0.25, 1)'; // Animasyon süresi ve hızı
            wheel.style.transform = `rotate(${finalTargetRotation}deg)`;

            // Animasyon bitince
            setTimeout(() => {
                wheel.style.transition = 'none'; // Animasyonu sıfırla
                // Doğru pozisyonda kalması için transformu ayarla (modülo 360)
                wheel.style.transform = `rotate(${finalTargetRotation % 360}deg)`;

                if (winningPrize > 0) {
                    currentUser.balance += winningPrize;
                    addTransaction('Çark Çevirme', winningPrize);
                    updateBalanceDisplay();
                    alert(`Tebrikler! ${winningPrize.toFixed(2)} TL kazandınız!`);
                    wheelMessage.textContent = `Kazandınız: ${winningPrize.toFixed(2)} TL`;
                } else {
                    addTransaction('Çark Çevirme', 0); // Kaybettiyse bile işleme kaydet
                    alert('Bu sefer kazanamadınız. Tekrar deneyin!');
                    wheelMessage.textContent = 'Maalesef bu sefer kazanamadınız.';
                }
                
                // Günlük çevirme limitini ayarla
                currentUser.lastSpinDate = new Date().toDateString();
                saveCurrentUserToLocalStorage();
                checkWheelSpinAvailability(); // Buton durumunu güncelle
            }, 4000); // CSS transition süresiyle aynı olmalı
        });

        // Site Mesajını Kapatma Butonu
        dismissSiteMessageButton.addEventListener('click', dismissSiteMessage);

        // Admin Paneli Site Mesajı Yönetimi
        adminSetSiteMessageButton.addEventListener('click', function() {
            const message = adminSiteMessageInput.value.trim();
            if (message) {
                localStorage.setItem('siteMessage', message);
                localStorage.removeItem('siteMessageDismissed'); // Mesajı tekrar gösterilebilir yap
                alert('Site mesajı başarıyla ayarlandı. Kullanıcılara gösterilecektir.');
                showSiteMessage(); // Dashboard açık değilse bile güncellemeyi tetikle
            } else {
                alert('Boş mesaj ayarlanamaz.');
            }
        });

        adminClearSiteMessageButton.addEventListener('click', function() {
            localStorage.removeItem('siteMessage');
            localStorage.removeItem('siteMessageDismissed');
            alert('Site mesajı temizlendi.');
            adminSiteMessageInput.value = '';
            siteMessageBox.classList.add('hidden'); // Dashboard açıksa gizle
        });


        // Sayfa yüklendiğinde oturum kontrolü yap
        window.onload = function() {
            createWheelSegments(); // Çarkı oluştur

            const storedUsers = getUsersFromLocalStorage();
            const lastLoggedInUser = localStorage.getItem('lastLoggedInUser');

            // Admin girişi kontrolü
            // Normal kullanıcı girişi veya admin girişi
            if (lastLoggedInUser === ADMIN_USERNAME) {
                 // Admin özel durumu
                showPage('admin-dashboard-page');
                renderUserList();
                updateAdminSiteMessageSection();
            }
            else if (lastLoggedInUser && storedUsers[lastLoggedInUser]) {
                currentUser = storedUsers[lastLoggedInUser];
                welcomeMessage.textContent = `Hoş Geldin, ${currentUser.username}!`;
                updateBalanceDisplay();
                updateTransactionHistory();
                checkWheelSpinAvailability(); // Oturum açıldığında çark durumunu kontrol et
                showSiteMessage(); // Oturum açıldığında site mesajını göster
                showPage('dashboard-page');
            } else {
                showPage('auth-page');
                toggleAuthMode(false); // Başlangıçta giriş modunda ol
            }
        };

    </script>
</body>
</html>